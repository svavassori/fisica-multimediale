package relat;import java.io.*;import util.Preloader;import ui.*;import java.awt.*;public class RelatFrame extends TrackedFrame implements StatusDisplayer  { ImageLoader il;    HelpDisplayer help;    Panel cardsPanel;    CardLayout cards;    Settings settings;    Options options;    Simulation simulation;    SimulationInfoDisplay simulationInfoDisplay;    SimulationDisplay simulationDisplay;    SimulationTable simulationTable;    SimulationGraphic simulationGraphic;    Label info_text;    Exit exit;    public RelatFrame()      { super("Dinamica relativistica");    }    public void go(Parameters parm, Exit exit) {        this.exit=exit;        il=UserInterface.getImageLoader();        help=UserInterface.getHelpDisplayer();        settings=new Settings();        options=new Options();        simulation=null;        setIconImage(il.load("icons/simul.gif"));        if (!WindowsTracker.isEnabled())            createMenuBar();        createToolbar();        createPanel();        createStatus();        resize(512, 384);        centerOnScreen();      }    void createMenuBar()      { Font font=new Font("Helvetica", Font.PLAIN, 12);        MenuBar mb=new MenuBar();        Menu m=new Menu("Esperimento");        m.add("Imposta parametri...");        m.add("Esegui");        m.addSeparator();        m.add("Opzioni simulazione...");        m.addSeparator();        m.add("Uscita...");        m.setFont(font);        mb.add(m);        m=new Menu("Visualizza");        m.add("Simulazione");        m.add("Grafico...");        m.add("Tabella");        m.setFont(font);        mb.add(m);        m=new Menu("Aiuto");        m.add("Aiuto");        mb.add(m);        mb.setFont(font);        //setMenuBar(mb);      }    void createToolbar()      { Toolbar tb=new Toolbar(Toolbar.VERTICAL);        tb.addTool("Imposta parametri...", il.load("icons/settings.gif"),                   "Imposta parametri");        tb.addTool("Esegui", il.load("icons/go.gif"),                   "Esegui simulazione");        tb.addTool("Simulazione", il.load("icons/simul.gif"),                   "Visualizza simulazione");        tb.addTool("Grafico...", il.load("icons/grafico.gif"),                   "Visualizza grafico");        tb.addTool("Tabella", il.load("icons/tabella.gif"),                   "Visualizza tabella");        tb.addTool("Uscita...", il.load("icons/exit.gif"),                   "Esci dal programma");        tb.setStatusDisplayer(this);        add("West", tb);      }    void createPanel()      { cardsPanel=new Panel();        cards=new CardLayout();        cardsPanel.setLayout(cards);        Panel simulationPanel=new Panel();        simulationPanel.setLayout(new BorderLayout());        simulationInfoDisplay=new SimulationInfoDisplay();        simulationPanel.add("North", simulationInfoDisplay);        simulationDisplay=new SimulationDisplay(this, options, settings,                                                simulationInfoDisplay);        simulationPanel.add("Center", simulationDisplay);        cardsPanel.add("Simulazione", simulationPanel);        cardsPanel.add("ExitPanel", new ExitPanel("*Exit*","*CancelExit*"));                simulationGraphic=new SimulationGraphic();        simulationGraphic.setStatusDisplayer(this);        cardsPanel.add("Grafico", simulationGraphic);        simulationTable=new SimulationTable();        cardsPanel.add("Tabella", simulationTable);                        add("Center", cardsPanel);      }    public void createStatus()      { Font font=new Font("Helvetica", Font.PLAIN, 12);        info_text=new Label("");        info_text.setBackground(Color.lightGray);        info_text.setAlignment(Label.CENTER);        info_text.setFont(font);        add("South", info_text);      }        public void show(String name)      { cards.show(cardsPanel, name);        cardsPanel.repaint();      }    public void showStatus(String status)      { info_text.setText(status);      }    public boolean action(Event evt, Object what)      {         if ("Uscita...".equals(what))            show("ExitPanel");        else if ("*CancelExit*".equals(what)) {            show("Simulazione");        }        else if ("*Exit*".equals(what))          { hide();            if (simulationDisplay!=null)              simulationDisplay.stopAnimation();             //salva su file C://Simul il numero 1            salva();            show("Simulazione");            exit.exit(this, null);          }        else if ("Imposta parametri...".equals(what))          { Dialog dialog=new SettingsDialog(this, settings);            dialog.reshape(50, 50, 500, 360);            dialog.show(true);            dialog.move(50, 50);            toFront();          }        else if ("Esegui".equals(what))          { show("Simulazione");            simulationDisplay.stopAnimation();            simulation=new Simulation(settings);            simulationInfoDisplay.set(simulation);            simulationDisplay.play(simulation);            simulationDisplay.startAnimation();          }        else if ("Opzioni simulazione...".equals(what))          { Dialog dialog=new OptionsDialog(this, options);            dialog.reshape(50, 50, 450, 340);            dialog.show(true);            dialog.move(50, 50);            toFront();          }        else if ("Simulazione".equals(what))          show("Simulazione");        else if ("Grafico...".equals(what))          { if (simulation==null || simulation.getStepCount()==0)              MessageBox.message(this,"Dinamica relativistica - Grafico",                     "Devi eseguire la simulazione prima\n"+                     "di poter visualizzare il grafico");            else              { Dialog dialog=new GraphicDialog(this, simulation);                dialog.reshape(50, 50, 550, 400);                dialog.show(true);                dialog.move(50, 50);                toFront();              }          }        else if ("Tabella".equals(what))          { if (simulation!=null && simulation.getStepCount()>0)              { simulationTable.update(simulation);              }            show("Tabella");          }        else if ("Aiuto".equals(what))          help.displayHelp("help/relat", "relat");        else if (what!=null && what instanceof Settings)          { settings=(Settings)what;            simulation=null;            simulationDisplay.reset(settings);          }        else if (what!=null && what instanceof Options)          { options=(Options)what;            simulationDisplay.setOptions(options);          }        else if (what!=null && what instanceof GraphicDialog)          { GraphicDialog gd=(GraphicDialog)what;            simulationGraphic.setData(simulation,                 gd.getXChoice(), gd.getYChoice());            show("Grafico");          }                return true;      }    public boolean handleEvent(Event evt)      { if (evt.id==Event.WINDOW_DESTROY)            show("ExitPanel");        return super.handleEvent(evt);      }    public void salva()                                                                                               //author Massimo      {                     try {	            Writer out = new FileWriter(Preloader.getSimulFileName());            out.write("1");            out.flush();            out.close();           }        catch(Exception e)           {     	      System.out.println("File non trovato");     	    }       	    }    }