import java.awt.*;import java.applet.*;import numeric.ODE;import numeric.ODESolver;public class Demo2 extends Applet implements ODE  { final int n=4;    final int pos[][]=   { {-100, -75},                           { 100, -75},                           { 100,  75},                           {-100,  75} };    final double charge[] = { +1, -1, +1, +1 };    final int radius=8;    final double step=1, minstep=0.0001;    final double maxerr=0.01;    final double scale=20.0;    boolean backwards=false;    ODESolver os;    public void init()      { os=new ODESolver(this, 0, new double[2], step, maxerr);        os.setMinStep(minstep);        setBackground(Color.white);      }    public void paint(Graphics g)      { Dimension d=size();        int x0=d.width/2;        int y0=d.height/2;        int i;        for(i=0; i<n; i++)          { int x=pos[i][0]+x0;            int y=pos[i][1]+y0;            g.setColor( charge[i]<0? Color.red: Color.blue);            g.fillOval(x-radius, y-radius, 2*radius, 2*radius);          }      }    public boolean mouseDown(Event evt, int x, int y)      { double s[]=new double[2];        int i;        Graphics g=getGraphics();        g.setColor(Color.green);        Dimension d=size();        int x0=d.width/2;        int y0=d.height/2;        int same;                for(i=0; i<2; i++)          { backwards= (i==1);            s[0]=x-x0;            s[1]=y-y0;            os.setY(s);            int x1=x, y1=y;            same=0;loop:       while(true)              {                 int x2, y2;                int j;                os.nextStep();                if (!os.isOk())                  { System.out.println("Status="+os.getStatus());                    break;                  }                x2=(int)(s[0]+x0);                y2=(int)(s[1]+y0);                g.drawLine(x1, y1, x2, y2);                if (x1!=x2 || y1!=y2)                  same=0;                else if (same++> 100)                  { System.out.println("Same");                    break loop;                  }                                  x1=x2;                y1=y2;                if (x1<0 || y1<0 || x1>d.width || y1>d.height)                  break loop;                for(j=0; j<n; j++)                  { if (Math.sqrt(square(x1-pos[j][0], y1-pos[j][1]))< radius)                      break loop;                  }              }                            if (!os.isOk())              { os=new ODESolver(this, 0, s, step, maxerr);                os.setMinStep(minstep);              }          }        backwards=false;        return false;      }     double square(double x, double y)      { return x*x+y*y;      }    public int getDimension()      { return 2;      }    public void derive(double t, double s[], double s1[])      { double ex=0, ey=0;        double x=s[0], y=s[1];        int i;        for(i=0; i<n; i++)          { double r, r2;            r2=square((x-pos[i][0])/scale, (y-pos[i][1])/scale);            r=Math.sqrt(r2);            if (r<radius/scale)              { r2=radius/scale*radius/scale;                r=radius/scale;              }            double r3=r*r2;            ex+= charge[i]*(x-pos[i][0])/r3;            ey+= charge[i]*(y-pos[i][1])/r3;          }        s1[0]=scale*(backwards? -ex: ex);        s1[1]=scale*(backwards? -ey: ey);      }  }