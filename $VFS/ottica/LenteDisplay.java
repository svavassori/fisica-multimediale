package ottica;import java.awt.*;import ui.*;import numeric.*;import util.*;/** * Simulazione di una lente sottile */public class LenteDisplay extends SimulationDisplay   { boolean oggetto_definito;    double f; // Distanza focale    double oggetto_x, oggetto_y;    double immagine_x, immagine_y;        public LenteDisplay(Settings settings, PaintableCanvas legenda,                             StatusDisplayer status)      { super(settings, legenda, status);      }    /**     * Riaggiorna la finestra a fronte di un cambiamento dei     * parametri     */    protected void cleanUp()      { oggetto_definito=false;        calcolaFuoco();      }    /**     *  Ricalcola il mapping tra coordinate logiche e coordinate reali     */    protected void recomputeWindow()      { super.recomputeWindow();        map.set(-5, -0.8, 5, 0.8);      }    /**     * Disegna la legenda     */    public void paint(Component com, Graphics g)      {        Dimension d=com.size();        FontMetrics fm=g.getFontMetrics();        int asc=fm.getAscent();        int h=fm.getHeight();        String str="Immagine di un oggetto attraverso una lente";        int w=fm.stringWidth(str);        g.setColor(Color.lightGray);        g.drawString(str, (d.width-w)/2+1, asc+3+1);        g.setColor(Color.blue);        g.drawString(str, (d.width-w)/2-2, asc+3-2);        g.setColor(Color.black);        g.drawString("Distanza focale: "+                     Format.format(".3", f)+"m",                     10, asc+3+h);        if (!oggetto_definito)          return;        str="Oggetto:  pos="+Format.format(".3", oggetto_x)+            "m  altezza="+Format.format(".3", oggetto_y)+"m";        g.drawString(str, 30, asc+3+2*h);        str="Immagine: pos="+Format.format(".3", immagine_x)+            "m  altezza="+Format.format(".3", immagine_y)+"m";        g.drawString(str, 30, asc+3+3*h);        g.setColor(coloreOggetto);        g.fillRect(10, 3+2*h, 10, asc);        g.setColor(coloreImmagine);        g.fillRect(10, 3+3*h, 10, asc);      }    /**     * vero se puo' visualizzare un oggetto e la sua immagine     */    public boolean canDisplayOggetto()      { return true;      }    /**     * vero se puo' visualizzare il percorso di un raggio luminoso     */    public boolean canDisplayRaggio()      { return false;      }    /**     * Restituisce true se il punto (in coordinate reali)     * e' attivo, ovvero puo' essere usato per il posizionamento     * di un oggetto o un raggio     */    protected boolean activePoint(double x, double y)      {         return x<-0.05;;      }    /**     * Inserisce un nuovo oggetto     */    protected void inserisciOggetto(double x, double y)      { oggetto_definito=true;        oggetto_x=x;        oggetto_y=y;        immagine_x=1/(1/f+1/x);        immagine_y=y*immagine_x/x;        repaint();      }    public void paint(Graphics g)    {   super.paint(g);        Rectangle old=clip(g);        Point zero=realToPixel(0, 0);        // Disegna l'asse ottico        g.setColor(Color.blue);        g.drawLine(0, zero.y, dim.width, zero.y);        // Marca i fuochi        if (Math.abs(f)<100)          { Point ptf1=realToPixel(-f, 0);            g.drawLine(ptf1.x, zero.y-5, ptf1.x, zero.y+5);            g.drawString("f1", ptf1.x, zero.y+12);            Point ptf2=realToPixel(f, 0);            g.drawLine(ptf2.x, zero.y-5, ptf2.x, zero.y+5);            g.drawString("f2", ptf2.x, zero.y+12);          }        // Disegna la lente        Point pta=new Point(zero.x, insets.top+30);        Point ptb=new Point(zero.x, dim.height-insets.bottom-30);        g.setColor(Color.magenta);        g.drawLine(pta.x, pta.y, ptb.x, ptb.y);        int dx=10;        int dy=10;        if (f<0) // lente divergente          dy=-dy;        g.drawLine(pta.x, pta.y, pta.x-dx, pta.y+dy);        g.drawLine(pta.x, pta.y, pta.x+dx, pta.y+dy);        g.drawLine(ptb.x, ptb.y, ptb.x-dx, ptb.y-dy);        g.drawLine(ptb.x, ptb.y, ptb.x+dx, ptb.y-dy);        // Disegna l'oggetto        if (oggetto_definito)          { Point pto=realToPixel(oggetto_x, oggetto_y);            g.setColor(coloreOggetto);            drawArrow(g, pto.x, zero.y, pto.x, pto.y);            Point pti=realToPixel(immagine_x, immagine_y);            g.setColor(coloreImmagine);            drawArrow(g, pti.x, zero.y, pti.x, pti.y);          }        clip(g, old);      }       /**     * Ricalcola la distanza focale      */    void calcolaFuoco()       { double r1=settings.lente_raggio_1;        double r2=settings.lente_raggio_2;        double n1=indiceRifrazione()-1;        if (n1==0.0)          { f=Double.POSITIVE_INFINITY;            return;          }        double t; // 1/R1 - 1/R2 con i segni opportuni        switch(settings.tipo_lente)          {            case Settings.BICONVESSA:                t=1/r1 + 1/r2;                break;            case Settings.BICONCAVA:                t=-1/r1 - 1/r2;                break;            case Settings.PIANO_CONVESSA_SINISTRA:                t=1/r1;                break;            case Settings.PIANO_CONVESSA_DESTRA:                t= 1/r2;                break;            case Settings.PIANO_CONCAVA_SINISTRA:                t=-1/r1;                break;            case Settings.PIANO_CONCAVA_DESTRA:                t=- 1/r2;                break;            case Settings.MENISCO_SINISTRA:                t=1/r1 - 1/r2;                break;            case Settings.MENISCO_DESTRA:                t=-1/r1 + 1/r2;                break;            default:                t=0.0;                break;          }        f=1/(n1*t);      }  }