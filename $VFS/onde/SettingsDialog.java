package onde;import ui.*;import util.*;import onde.*;import java.awt.*;/** * A dialog box to input new settings */public class SettingsDialog extends TrackedDialog  {     Component target;    Settings initial;    HelpDisplayer help;    static Font font_small=new Font("TimesRoman", Font.PLAIN, 12);    static Font font_medium=new Font("TimesRoman", Font.PLAIN, 14);    static Font font_large=new Font("TimesRoman", Font.BOLD, 16);    TabsPanel tabs;    CheckboxGroup cbg;    Checkbox cb[];    NumericInput vel;    NumericInput periodo;    TextField x[], y[];    NumericInput dir[];    NumericInput fase[];    Panel cards_panel;    CardLayout cards;    /**     * Create a new settings dialog. If the user confirms     * the changes, the target component will be notified with     * an action event having a Settings object as the argument     */    public SettingsDialog(Component target, Settings initial)      { super(UserInterface.getDummyFrame(),               "Impostazione dei parametri", true);        this.target=target;        this.initial=initial;        help=UserInterface.getHelpDisplayer();        // setLayout(new VerticalLayout(VerticalLayout.JUSTIFIED));        setLayout(new BorderLayout());                //        // Crea la barra di bottoni in alto        //        tabs=new TabsPanel();        tabs.setFont(font_small);        tabs.add("Tipo di onde");        tabs.add("Onda 1");        tabs.add("Onda 2");        add("North", tabs);        cards_panel=new Panel();        cards=new CardLayout();        cards_panel.setLayout(cards);        Label lab;        //        // Crea il pannello con l'input del tipo di onde        //        Panel tipo_panel=new Panel();        tipo_panel.setLayout(new VerticalLayout(VerticalLayout.LEFT));        lab=new Label("Tipo di onde");        lab.setFont(font_large);        tipo_panel.add("", lab);        cbg=new CheckboxGroup();        cb=new Checkbox[Settings.TIPI_DI_ONDE];        cb[Settings.ONDE_PIANE]=             new Checkbox("Onde piane", cbg, false);        tipo_panel.add("", cb[Settings.ONDE_PIANE]);        cb[Settings.ONDE_CIRCOLARI]=             new Checkbox("Onde circolari", cbg, false);        tipo_panel.add("", cb[Settings.ONDE_CIRCOLARI]);        int i;        for(i=0; i<Settings.TIPI_DI_ONDE; i++)          cb[i].setFont(font_medium);                lab=new Label("VelocitÃ  di propagazione [m/s]");        lab.setFont(font_medium);        tipo_panel.add("", lab);        vel=new NumericInput(1, 3000, 5, 0.2);        vel.setValue(initial.vel);        tipo_panel.add("", vel);        lab=new Label("Periodo [s]");        lab.setFont(font_medium);        tipo_panel.add("", lab);        periodo=new NumericInput(1, 3000, 50, 0.02);        periodo.setValue(initial.periodo);        tipo_panel.add("", periodo);        cards_panel.add("Tipo", tipo_panel);                //        // Crea i pannelli con l'input per le caratteristiche        // delle onde        //        int onda;        Panel onda_panel;        x=new TextField[Settings.ONDE];        y=new TextField[Settings.ONDE];        dir=new NumericInput[Settings.ONDE];        fase=new NumericInput[Settings.ONDE];        for(i=0; i<Settings.ONDE; i++)          {            onda_panel=new Panel();            onda_panel.setLayout(new VerticalLayout(VerticalLayout.LEFT));                lab=new Label("Caratteristiche delle onde - Onda "+(i+1));            lab.setFont(font_large);            onda_panel.add("", lab);                    lab=new Label("Fase [deg]");            lab.setFont(font_medium);            onda_panel.add("", lab);                fase[i]=new NumericInput(-180, 180, 0, 1);            fase[i].setValue(initial.fase[i]);            onda_panel.add("", fase[i]);            Panel subpan=new Panel();            subpan.setLayout(new FlowLayout(FlowLayout.LEFT));            lab=new Label("Posizione X del centro [m]");            lab.setFont(font_medium);            subpan.add("", lab);            x[i]=new TextField(10);            x[i].setText(Format.format(".3", initial.x[i]));            x[i].setFont(font_medium);            subpan.add("", x[i]);            onda_panel.add("", subpan);            subpan=new Panel();            subpan.setLayout(new FlowLayout(FlowLayout.LEFT));            lab=new Label("Posizione Y del centro [m]");            lab.setFont(font_medium);            subpan.add("", lab);            y[i]=new TextField(10);            y[i].setText(Format.format(".3", initial.y[i]));            y[i].setFont(font_medium);            subpan.add("", y[i]);            onda_panel.add("", subpan);            lab=new Label("Direzione di propagazione [deg]");            lab.setFont(font_medium);            onda_panel.add("", lab);            dir[i]=new NumericInput(-180, 180, 0, 1);            dir[i].setValue(initial.dir[i]);            onda_panel.add("", dir[i]);            cards_panel.add("Onda "+(i+1), onda_panel);          }        add("Center", cards_panel);        cards.show(cards_panel, "Tipo");        //        // Crea la barra di bottoni in basso        //        ImageLoader il=UserInterface.getImageLoader();        Panel confirm_panel=new Panel();        confirm_panel.setFont(font_large);        confirm_panel.setLayout(new FlowLayout(FlowLayout.LEFT));        confirm_panel.add("", new ImageButton3D("OK",                                   il.load("icons/ok.gif")));        confirm_panel.add("", new ImageButton3D("Annulla",                                   il.load("icons/cancel.gif")));        confirm_panel.add("", new ImageButton3D("Aiuto",                                   il.load("icons/help.gif")));        add("South", confirm_panel);        cbg.setCurrent(cb[initial.tipo]);        checkCheckboxes();      }    public boolean action(Event evt, Object what)      { if ("OK".equals(what))          { dispose();            Settings settings=new Settings();            Checkbox curr=cbg.getCurrent();            int i;            for(i=0; i<Settings.TIPI_DI_ONDE; i++)              if (curr==cb[i])                settings.tipo=i;            settings.vel=vel.getValue();            settings.periodo=periodo.getValue();            for(i=0; i<Settings.ONDE; i++)              { settings.x[i]=getValue(x[i]);                settings.y[i]=getValue(y[i]);                settings.dir[i]=(int)dir[i].getValue();                settings.fase[i]=(int)fase[i].getValue();              }            target.deliverEvent(new Event(target, Event.ACTION_EVENT, settings));          }        else if ("Annulla".equals(what))          { dispose();          }        else if ("Aiuto".equals(what))          { help.displayHelp("help/onde", "param");          }        else if ("Tipo di onde".equals(what))          { cards.show(cards_panel, "Tipo");            tabs.show("Tipo di onde");             validate();          }        else if ("Onda 1".equals(what))          { cards.show(cards_panel, "Onda 1");            tabs.show("Onda 1");            resize(550, 420);             validate();          }        else if ("Onda 2".equals(what))          { cards.show(cards_panel, "Onda 2");            tabs.show("Onda 2");            resize(550, 420);             validate();          }        else if (evt.target instanceof Checkbox)          { checkCheckboxes();          }        return true;      }    private boolean first_expose=true;    public boolean handleEvent(Event evt)      { if (evt.id == Event.WINDOW_DESTROY)          dispose();        else if (evt.id==Event.WINDOW_EXPOSE && first_expose)          { first_expose=false;            resize(550, 420);          }        else if (evt.target instanceof TextField &&             (evt.id==Event.LOST_FOCUS || (evt.id==Event.KEY_PRESS &&                                          evt.key=='\n')))          { int i;            TextField f=(TextField)evt.target;            for(i=0; i<Settings.ONDE; i++)              { if (f==x[i] || f==y[i])                  { f.setText(Format.format(".3", getValue(f)));                  }              }          }        return super.handleEvent(evt);      }    void checkCheckboxes()      { int tipo=0;        Checkbox curr=cbg.getCurrent();        int i;        for(i=0; i<Settings.TIPI_DI_ONDE; i++)          if (curr==cb[i])            tipo=i;        for(i=0; i<Settings.ONDE; i++)          { x[i].enable(tipo==Settings.ONDE_CIRCOLARI);            y[i].enable(tipo==Settings.ONDE_CIRCOLARI);            dir[i].enable(tipo==Settings.ONDE_PIANE);          }      }    double getValue(TextField f)      { try           { return Double.valueOf(f.getText()).doubleValue();          }        catch (NumberFormatException e)          { return 0;          }      }  }