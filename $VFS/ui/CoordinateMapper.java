package ui;import java.awt.*;/** * Implements a mapping function between "real" coordinates * and the pixel coordinates * @author Pasquale Foggia * @version 0.99, Dec 1997 */public class CoordinateMapper  { double x1=0,y1=0,x2=1,y2=1;    Dimension d=new Dimension(1, 1);    Insets in=new Insets(0, 0, 0, 0);    boolean isometric=false;    double scale_x=1, scale_y=1;    int ofsx, ofsy;    public void set(double x1, double y1, double x2, double y2)      { this.x1=x1;        this.y1=y1;        this.x2=x2;        this.y2=y2;        rescale();      }    public void set(Dimension d)      { this.d=new Dimension(d.width, d.height);        in=new Insets(0, 0, 0, 0);        rescale();      }    public void set(Dimension d, Insets in)      { this.d=new Dimension(d.width-in.left-in.right,                               d.height-in.top-in.bottom);        this.in=(Insets)in.clone();        rescale();      }    public void setIsometric(boolean iso)      { isometric=iso;        rescale();      }    /**     * Returns the dimension of the mapped area without the insets     */    public Dimension getDimension()      { return new Dimension(d.width, d.height);      }    public Insets getInsets()      { return (Insets)in.clone();      }    /**     * Returns the ratio between pixel width and real width     */    public double getScaleX()      { return scale_x;      }    /**     * Returns the ratio between pixel height and real height     */    public double getScaleY()      { return scale_y;      }    private void rescale()      { scale_x=d.width/(x2-x1);        scale_y=d.height/(y2-y1);        if (isometric)          { if (scale_x > scale_y)              scale_x=scale_y;            else              scale_y=scale_x;            ofsx=(int)(d.width-scale_x*(x2-x1))/2;            ofsy=(int)(d.height-scale_y*(y2-y1))/2;          }        else          ofsx=ofsy=0;      }    public Point realToPixel(double x, double y)      { int ix = ofsx + in.left + (int)Math.floor((x-x1)*scale_x+0.499);        int iy = in.top  + d.height - ofsy                      - (int)Math.floor((y-y1)*scale_y+0.499);        return new Point(ix, iy);       }    public void pixelToReal(int ix, int iy, double z[])      { z[0]= x1 + (ix-in.left-ofsx)/scale_x;        z[1]= y1 + (in.top + d.height - ofsy - iy)/scale_y;      }    public double[] pixelToReal(int ix, int iy)      { double z[]=new double[2];        pixelToReal(ix, iy, z);        return z;      }  }